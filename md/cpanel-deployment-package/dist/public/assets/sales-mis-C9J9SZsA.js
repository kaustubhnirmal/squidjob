import{ae as q,r,a4 as S,j as e,a6 as A,a0 as B,S as K,G as O,H as Q,J as V,K as M,a7 as G,a8 as l,a9 as k,B as o,aa as H,ab as J,ac as y,ad as W}from"./index-DSPCxSv1.js";function se(){const C=q(),[t,m]=r.useState({from:void 0,to:void 0}),[p,f]=r.useState(""),[X,Y]=r.useState(!1),[n,D]=r.useState(1),[i,I]=r.useState(10),[g,N]=r.useState(!1),[h,P]=r.useState(!1),{data:w=[],isLoading:R}=S({queryKey:["/api/users"],queryFn:async()=>{const s=await fetch("/api/users");if(!s.ok)throw new Error("Failed to fetch users");return s.json()}}),{data:u=[],isLoading:Z,refetch:E}=S({queryKey:["/api/sales-mis"],queryFn:async()=>{let s="/api/sales-mis";const d=new URLSearchParams;p&&d.append("username",p),t.from&&d.append("startDate",t.from.toISOString()),t.to&&d.append("endDate",t.to.toISOString()),d.toString()&&(s+=`?${d.toString()}`);const c=await fetch(s);if(!c.ok)throw new Error("Failed to fetch sales MIS data");return c.json()},enabled:!R}),L=r.useMemo(()=>w,[w]),x=r.useMemo(()=>u||[],[u]),T=()=>{E()},U=()=>{f(""),m({from:void 0,to:void 0}),C.invalidateQueries({queryKey:["/api/sales-mis"]})},v=s=>{s?(m({from:s.from,to:s.to}),s.to&&N(!1)):m({from:void 0,to:void 0})},F=()=>{const s=x.map(a=>({ID:a.id,"User Name":a.displayName||a.name||a.username,Assigned:a.assigned,"In Process":a.inProcess,Submitted:a.submitted,Cancelled:a.cancelled,Awarded:a.awarded,Lost:a.lost,Rejected:a.rejected,Dropped:a.dropped,Reopened:a.reopened,"Total Tender":a.totalTender})),d=y.json_to_sheet(s),c=y.book_new();y.book_append_sheet(c,d,"Sales MIS");const $=`Sales_MIS_${l(new Date,"yyyy-MM-dd")}.xlsx`;W(c,$)},z=()=>t.from&&t.to?`${l(t.from,"dd/MM/yyyy")} - ${l(t.to,"dd/MM/yyyy")}`:t.from?`${l(t.from,"dd/MM/yyyy")} - Select End Date`:t.to?`Select Start Date - ${l(t.to,"dd/MM/yyyy")}`:"Date From -- Date To",j=Math.ceil(x.length/i),b=s=>{s>0&&s<=j&&D(s)},_=r.useMemo(()=>{const s=(n-1)*i;return x.slice(s,s+i)},[x,n,i]);return e.jsxs("div",{className:"p-6 max-w-full",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Sales MIS"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-lg font-medium",children:"Search"})]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 p-2",onClick:()=>P(!h),children:h?e.jsx(A,{size:18}):e.jsx(B,{size:18})})]}),h&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{children:e.jsxs(K,{value:p,onValueChange:f,children:[e.jsx(O,{className:"w-full bg-white",children:e.jsx(Q,{placeholder:"User Name"})}),e.jsxs(V,{children:[e.jsx(M,{value:"all",children:"All Users"}),L.map(s=>e.jsx(M,{value:s.username,children:s.name||s.username},s.id))]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative border border-input rounded-md px-3 py-2 bg-white text-sm flex items-center cursor-pointer",onClick:()=>N(!g),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:z()})]}),g&&e.jsx("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-center font-medium mb-2",children:l(new Date,"MMM yyyy")}),e.jsx(k,{mode:"range",selected:{from:t.from,to:t.to},onSelect:v,className:"rounded-md border"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-center font-medium mb-2",children:l(new Date(new Date().setMonth(new Date().getMonth()+1)),"MMM yyyy")}),e.jsx(k,{mode:"range",selected:{from:t.from,to:t.to},onSelect:v,defaultMonth:new Date(new Date().setMonth(new Date().getMonth()+1)),className:"rounded-md border"})]})]})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"bg-[#0076a8] hover:bg-[#00608a] text-white px-8",onClick:T,children:"Search"}),e.jsx(o,{variant:"outline",className:"border-gray-300 px-8",onClick:U,children:"Clear"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"flex justify-end p-4",children:e.jsxs(o,{variant:"outline",className:"flex items-center gap-2 border-gray-300",onClick:F,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export to Excel"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"User Name"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Assigned"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"In Process"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Submitted"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Cancelled"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Awarded"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Lost"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Rejected"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Dropped"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Reopened"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"Total Tender"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:s.id}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:s.displayName||s.name||s.username}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.assigned}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.inProcess}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.submitted}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.cancelled}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.awarded}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.lost}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.rejected}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.dropped}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.reopened}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:s.totalTender})]},s.id))})]})}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("select",{className:"mr-2 border-gray-300 rounded-md text-sm",value:i,onChange:s=>I(Number(s.target.value)),children:[e.jsx("option",{value:10,children:"Show 10"}),e.jsx("option",{value:25,children:"Show 25"}),e.jsx("option",{value:50,children:"Show 50"}),e.jsx("option",{value:100,children:"Show 100"})]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n," of ",j]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",className:"border-gray-300",onClick:()=>b(n-1),disabled:n===1,children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",className:"border-gray-300",onClick:()=>b(n+1),disabled:n===j,children:e.jsx(J,{className:"h-4 w-4"})})]})]})]})]})}export{se as default};
