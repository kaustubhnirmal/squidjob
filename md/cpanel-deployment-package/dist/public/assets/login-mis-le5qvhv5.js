import{r,a4 as L,j as e,a5 as G,a6 as J,a0 as Q,I as W,S as E,G as T,H as P,J as H,K as c,a7 as A,a8 as n,a9 as F,B as w,aa as Z,ab as X,ac as N,ad as Y}from"./index-DSPCxSv1.js";function ae(){var C,I;const[a,y]=r.useState({from:void 0,to:void 0}),[m,v]=r.useState("all"),[h,b]=r.useState(""),[g,j]=r.useState(!1),[p,_]=r.useState(!1),[t,$]=r.useState(1),[i,q]=r.useState(10),{data:S=[],isLoading:ee}=L({queryKey:["/api/users"],queryFn:async()=>{const s=await fetch("/api/users");if(!s.ok)throw new Error("Failed to fetch users");return s.json()}}),{data:f=[],isLoading:O,refetch:U}=L({queryKey:["/api/login-mis",h,m,(C=a.from)==null?void 0:C.toISOString(),(I=a.to)==null?void 0:I.toISOString()],queryFn:async()=>{const s=new URLSearchParams;h&&s.append("employeeId",h),m&&m!=="all"&&s.append("employeeName",m),a.from&&s.append("fromDate",a.from.toISOString()),a.to&&s.append("toDate",a.to.toISOString());const d=s.toString()?`?${s.toString()}`:"",x=await fetch(`/api/login-mis${d}`);if(!x.ok)throw new Error("Failed to fetch login data");return await x.json()},enabled:!0}),B=r.useMemo(()=>S,[S]),u=r.useMemo(()=>f.length>0?f:[{id:1,userId:1,employeeName:"Poonam Amale",loginDateTime:"2023-05-13T10:00:00.000Z",logoutDateTime:void 0,ipAddress:"192.168.224.2"}],[f]),K=()=>{U()},R=()=>{b(""),v("all"),y({from:void 0,to:void 0})},V=()=>{const s=u.map(l=>({ID:l.id,"Employee Name":l.employeeName,"Login Date Time":l.loginDateTime?n(new Date(l.loginDateTime),"dd-MM-yyyy HH:mm:ss"):"-","Logout Date Time":l.logoutDateTime?n(new Date(l.logoutDateTime),"dd-MM-yyyy HH:mm:ss"):"-","IP Address":l.ipAddress})),d=N.json_to_sheet(s),x=N.book_new();N.book_append_sheet(x,d,"Login MIS");const z=`Login_MIS_${n(new Date,"yyyy-MM-dd")}.xlsx`;Y(x,z)},o=Math.ceil(u.length/i),D=s=>{s>0&&s<=o&&$(s)},M=r.useMemo(()=>{const s=(t-1)*i;return u.slice(s,s+i)},[u,t,i]),k=s=>{s?(y({from:s.from,to:s.to}),s.to&&j(!1)):y({from:void 0,to:void 0})};return e.jsxs("div",{className:"p-6 max-w-full",children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Login MIS"})}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-5 w-5 text-gray-500 mr-2"}),e.jsx("span",{className:"text-lg font-medium",children:"Search"})]}),e.jsx("button",{onClick:()=>_(!p),className:"text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":p?"Collapse search panel":"Expand search panel",children:p?e.jsx(J,{className:"h-5 w-5"}):e.jsx(Q,{className:"h-5 w-5"})})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-x-4 gap-y-3",children:[e.jsx("div",{children:e.jsx(W,{placeholder:"Employee ID",className:"w-full bg-white",value:h,onChange:s=>b(s.target.value)})}),e.jsx("div",{children:e.jsxs(E,{value:m,onValueChange:v,children:[e.jsx(T,{className:"w-full bg-white",children:e.jsx(P,{placeholder:"Employee Name"})}),e.jsxs(H,{children:[e.jsx(c,{value:"all",children:"All Employees"}),B.map(s=>e.jsx(c,{value:s.username||`user-${s.id}`,children:s.name||s.username},s.id))]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"relative border border-input rounded-md px-3 py-2 bg-white text-sm flex items-center cursor-pointer",onClick:()=>j(!g),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:a.from?n(a.from,"dd/MM/yyyy"):"Login Date From"})]})}),e.jsx("div",{children:e.jsxs("div",{className:"relative border border-input rounded-md px-3 py-2 bg-white text-sm flex items-center cursor-pointer",onClick:()=>j(!g),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:a.to?n(a.to,"dd/MM/yyyy"):"Login Date To"})]})})]}),g&&e.jsx("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-md shadow-lg",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-center font-medium mb-2",children:n(new Date,"MMM yyyy")}),e.jsx(F,{mode:"range",selected:{from:a.from,to:a.to},onSelect:k,className:"rounded-md border"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-center font-medium mb-2",children:n(new Date(new Date().setMonth(new Date().getMonth()+1)),"MMM yyyy")}),e.jsx(F,{mode:"range",selected:{from:a.from,to:a.to},onSelect:k,defaultMonth:new Date(new Date().setMonth(new Date().getMonth()+1)),className:"rounded-md border"})]})]})}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(w,{className:"bg-[#0076a8] hover:bg-[#00608a] text-white px-6",onClick:K,children:"Search"}),e.jsx(w,{variant:"outline",className:"border-gray-300 px-6",onClick:R,children:"Clear"})]})]})]}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(w,{variant:"outline",className:"flex items-center gap-2 border-gray-300",onClick:V,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Export To Excel"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Employee ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Employee Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Login Date Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Logout Date Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"IP Address"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-4 text-center",children:"Loading..."})}):M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-4 text-center",children:"No data found"})}):M.map((s,d)=>e.jsxs("tr",{className:d%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center whitespace-nowrap",children:(t-1)*i+d+1}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.employeeName}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.loginDateTime?n(new Date(s.loginDateTime),"dd-MM-yyyy HH:mm:ss"):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.logoutDateTime?n(new Date(s.logoutDateTime),"dd-MM-yyyy HH:mm:ss"):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.ipAddress})]},s.id))})]})}),e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-700 mr-2",children:"Show"}),e.jsxs(E,{value:i.toString(),onValueChange:s=>q(parseInt(s)),children:[e.jsx(T,{className:"w-16 h-8",children:e.jsx(P,{placeholder:"10"})}),e.jsxs(H,{children:[e.jsx(c,{value:"10",children:"10"}),e.jsx(c,{value:"25",children:"25"}),e.jsx(c,{value:"50",children:"50"}),e.jsx(c,{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-sm text-gray-700 mr-2",children:["Page ",t," of ",o||1]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>D(t-1),disabled:t===1,className:`inline-flex items-center justify-center w-8 h-8 border ${t===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-100"} rounded-l-md`,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(t+1),disabled:t===o||o===0,className:`inline-flex items-center justify-center w-8 h-8 border ${t===o||o===0?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-100"} rounded-r-md`,children:e.jsx(X,{className:"h-4 w-4"})})]})]})]})]})]})}export{ae as default};
