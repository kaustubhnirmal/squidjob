import{n as us,ae as hs,af as xs,r as a,a4 as z,ag as E,ah as u,j as e,B as i,ai as ps,C as js,q as fs,T as Ie,s as Fe,t as g,v as o,w as Te,x as c,aj as me,ak as ue,al as he,am as gs,an as xe,ao as Pe,ap as Le,S as Oe,G as Ae,H as qe,J as Ue,K as v,D as K,i as B,k as Q,l as V,L as x,I as N,X as vs,$ as Ns}from"./index-DSPCxSv1.js";function ys(){const{toast:n}=us(),p=hs(),{currentUser:ws}=xs(),[Me,I]=a.useState(!1),[Re,F]=a.useState(!1),[$e,T]=a.useState(!1),[ze,G]=a.useState(!1),[H,pe]=a.useState(""),[J,y]=a.useState(""),[d,m]=a.useState(null),[Y,X]=a.useState(""),[w,b]=a.useState(""),[je,P]=a.useState(null),[L,O]=a.useState("briefcase"),[W,C]=a.useState(""),[Z,k]=a.useState(!1),[_,A]=a.useState(""),[fe,ee]=a.useState(null),[ge,q]=a.useState(""),[Ke,j]=a.useState(!1),se=a.useRef(null),[h,Be]=a.useState(null),[bs,Cs]=a.useState(!1),[S,te]=a.useState(1),[U,Qe]=a.useState(10),[D,ae]=a.useState(1),[M,Ve]=a.useState(10),{data:R=[],isLoading:Ge}=z({queryKey:["/api/checklists"],queryFn:async()=>{const t=await(await u("/api/checklists",{method:"GET"})).json();return console.log("Checklists data:",t),t}}),{data:ve=[]}=z({queryKey:["/api/files"],queryFn:async()=>{const t=await(await u("/api/files",{method:"GET"})).json();return console.log("Files table data:",t),t}}),{data:He=[]}=z({queryKey:["/api/folders"],queryFn:async()=>{const t=await(await u("/api/folders",{method:"GET"})).json();console.log("Folders data:",t);const l=t.filter(r=>r&&r.id&&r.name&&typeof r.id=="number");return console.log("Valid folders:",l),l}}),Ne=ve.filter(s=>s.name.toLowerCase().includes(W.toLowerCase())),ye=He.filter(s=>s&&s.name&&s.name.toLowerCase().includes(ge.toLowerCase()));a.useEffect(()=>{const s=t=>{se.current&&!se.current.contains(t.target)&&j(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const Je=s=>{b(s.id.toString()),A(s.name),k(!1),C(""),P(null),O("briefcase");const t=document.querySelector('input[type="file"]');t&&(t.value="")},Ye=()=>{b(""),A(""),C("")};a.useEffect(()=>{const s=t=>{Z&&!t.target.closest(".document-dropdown")&&k(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[Z]);const{data:$=[],isLoading:ks}=z({queryKey:["/api/checklists",h,"documents"],queryFn:async()=>h?(await u(`/api/checklists/${h}/documents`,{method:"GET"})).json():[],enabled:!!h}),we=R.length,ne=Math.ceil(we/U),ie=(S-1)*U,Xe=ie+U,be=R.slice(ie,Xe),Ce=$.length,le=Math.ceil(Ce/M),ke=(D-1)*M,We=ke+M,Ze=$.slice(ke,We);a.useEffect(()=>{te(1)},[R.length]),a.useEffect(()=>{ae(1)},[h,$.length]);const re=E({mutationFn:async s=>(await u("/api/checklists",{method:"POST",body:JSON.stringify({name:s})})).json(),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/checklists"]}),I(!1),pe(""),n({title:"Success",description:"Checklist created successfully"})},onError:()=>{n({title:"Error",description:"Failed to create checklist",variant:"destructive"})}}),ce=E({mutationFn:async({id:s,name:t})=>(await u(`/api/checklists/${s}`,{method:"PUT",body:JSON.stringify({name:t})})).json(),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/checklists"]}),F(!1),y(""),m(null),n({title:"Success",description:"Checklist updated successfully"})},onError:()=>{n({title:"Error",description:"Failed to update checklist",variant:"destructive"})}}),de=E({mutationFn:async s=>{await u(`/api/checklists/${s}`,{method:"DELETE"})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/checklists"]}),T(!1),m(null),n({title:"Success",description:"Checklist deleted successfully"})},onError:()=>{n({title:"Error",description:"Failed to delete checklist",variant:"destructive"})}}),oe=E({mutationFn:async s=>{const t=new FormData;t.append("checklistId",s.checklistId.toString()),t.append("documentName",s.documentName),s.fileId&&t.append("fileId",s.fileId.toString()),s.file&&t.append("file",s.file),s.folderId&&t.append("folderId",s.folderId.toString());const l=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).id:null,r=await fetch("/api/checklists/documents",{method:"POST",headers:{"x-user-id":(l==null?void 0:l.toString())||""},body:t});if(!r.ok)throw new Error("Failed to add document");return r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/checklists"]}),p.invalidateQueries({queryKey:["/api/checklists",h,"documents"]}),_e(),n({title:"Success",description:"Document added to checklist successfully"})},onError:()=>{n({title:"Error",description:"Failed to add document to checklist",variant:"destructive"})}}),Se=()=>{X(""),b(""),P(null),O("briefcase"),m(null),C(""),A(""),ee(null),q(""),k(!1),j(!1)},_e=()=>{X(""),b(""),P(null),O("briefcase"),C(""),A(""),ee(null),q(""),k(!1),j(!1)},es=()=>{if(!H.trim()){n({title:"Error",description:"Checklist name is required",variant:"destructive"});return}re.mutate(H.trim())},ss=s=>{try{if(!s||!s.id||!s.name){n({title:"Error",description:"Invalid checklist data",variant:"destructive"});return}m(s),y(s.name),F(!0)}catch(t){console.error("Edit checklist error:",t),n({title:"Error",description:"Failed to open edit dialog",variant:"destructive"})}},ts=()=>{if(!d||!J.trim()){n({title:"Error",description:"Checklist name is required",variant:"destructive"});return}ce.mutate({id:d.id,name:J.trim()})},as=s=>{m(s),T(!0)},ns=()=>{d&&de.mutate(d.id)},is=s=>{m(s),Be(s.id),G(!0)},ls=E({mutationFn:async s=>{await u(`/api/checklists/documents/${s}`,{method:"DELETE"})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/checklists",h,"documents"]}),n({title:"Success",description:"Document removed from checklist successfully"})},onError:s=>{console.error("Delete error:",s),n({title:"Error",description:"Failed to remove document",variant:"destructive"})}}),rs=async s=>{try{let t="",l=s.documentName;if(s.fileId){const Ee=ve.find(ms=>ms.id===s.fileId);Ee?(t=`/api/files/${s.fileId}/download`,l=Ee.name):t=`/api/checklists/documents/${s.id}/download`}else s.filePath?(t=`/api/uploads/download?path=${encodeURIComponent(s.filePath)}`,l=s.fileName||s.documentName):(t=`/api/checklists/documents/${s.id}/download`,l=s.fileName||s.documentName);const r=await fetch(t);if(!r.ok)throw new Error(`Download failed: ${r.status}`);const os=await r.blob(),De=window.URL.createObjectURL(os),f=document.createElement("a");f.style.display="none",f.href=De,f.download=l,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(De),document.body.removeChild(f),n({title:"Success",description:"Document downloaded successfully"})}catch(t){console.error("Download error:",t),n({title:"Error",description:`Failed to download document: ${t.message}`,variant:"destructive"})}},cs=s=>{window.confirm(`Are you sure you want to remove "${s.documentName}" from this checklist?`)&&ls.mutate(s.id)},ds=()=>{if(!d||!Y.trim()){n({title:"Error",description:"Document name is required",variant:"destructive"});return}if(!fe){n({title:"Error",description:"Please select a folder",variant:"destructive"});return}if(L==="briefcase"&&!w){n({title:"Error",description:"Please select a file from briefcase",variant:"destructive"});return}if(L==="upload"&&!je){n({title:"Error",description:"Please select a file to upload",variant:"destructive"});return}oe.mutate({checklistId:d.id,documentName:Y.trim(),fileId:L==="briefcase"?parseInt(w):void 0,file:L==="upload"?je:void 0,folderId:fe})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end items-center mb-6",children:e.jsxs(i,{onClick:()=>I(!0),className:"bg-[#0076a8] hover:bg-[#005a7d]",children:[e.jsx(ps,{className:"mr-2 h-4 w-4"}),"Add Check List"]})}),e.jsx(js,{children:e.jsxs(fs,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ie,{children:[e.jsx(Fe,{className:"bg-[#0076a8] text-white",children:e.jsxs(g,{children:[e.jsx(o,{className:"text-white font-medium text-center",children:"#"}),e.jsx(o,{className:"text-white font-medium",children:"CHECK LIST NAME"}),e.jsx(o,{className:"text-white font-medium",children:"CREATED BY"}),e.jsx(o,{className:"text-white font-medium",children:"CREATED DATE & TIME"}),e.jsx(o,{className:"text-white font-medium text-center",children:"ACTION"})]})}),e.jsx(Te,{children:Ge?e.jsx(g,{children:e.jsx(c,{colSpan:5,className:"text-center py-4",children:"Loading..."})}):be.length===0?e.jsx(g,{children:e.jsx(c,{colSpan:5,className:"text-center py-4",children:R.length===0?"No checklists found. Create your first checklist.":"No checklists on this page."})}):be.map((s,t)=>e.jsxs(g,{children:[e.jsx(c,{className:"text-center",children:ie+t+1}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.createdBy}),e.jsx(c,{children:new Date(s.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(me,{children:e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ss(s),className:"h-8 w-8 p-0",children:e.jsx(gs,{className:"h-4 w-4"})})}),e.jsx(xe,{children:e.jsx("p",{children:"Edit"})})]})}),e.jsx(me,{children:e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(i,{variant:"outline",size:"sm",onClick:()=>as(s),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsx(xe,{children:e.jsx("p",{children:"Delete"})})]})}),e.jsx(me,{children:e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(i,{variant:"outline",size:"sm",onClick:()=>is(s),className:"h-8 w-8 p-0 text-green-600 hover:text-green-700",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsx(xe,{children:e.jsx("p",{children:"Add Document"})})]})})]})})]},s.id))})]})}),we>0&&e.jsxs("div",{className:"bg-white px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs(Oe,{value:U.toString(),onValueChange:s=>Qe(Number(s)),children:[e.jsx(Ae,{className:"w-16 h-8",children:e.jsx(qe,{})}),e.jsxs(Ue,{children:[e.jsx(v,{value:"10",children:"10"}),e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",S," of ",ne]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>te(s=>Math.max(s-1,1)),disabled:S===1,className:"px-3 h-8",children:"Prev"}),e.jsx("span",{className:"px-3 py-1 bg-purple-600 text-white text-sm rounded min-w-[32px] text-center",children:S}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>te(s=>Math.min(s+1,ne)),disabled:S===ne,className:"px-3 h-8",children:"Next"})]})]})]})}),e.jsx(K,{open:Me,onOpenChange:I,children:e.jsxs(B,{className:"sm:max-w-[400px]",children:[e.jsx(Q,{children:e.jsx(V,{children:"Add Check List"})}),e.jsx("div",{className:"space-y-4 py-2",children:e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Check List Name*"}),e.jsx(N,{placeholder:"Enter checklist name",value:H,onChange:s=>pe(s.target.value),className:"border-gray-300 mt-1"})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(i,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsx(i,{onClick:es,disabled:re.isPending,className:"bg-[#0076a8] hover:bg-[#005a7d]",children:re.isPending?"Creating...":"Create"})]})]})}),e.jsx(K,{open:Re,onOpenChange:s=>{s||(y(""),m(null)),F(s)},children:e.jsxs(B,{className:"sm:max-w-[400px]",children:[e.jsx(Q,{children:e.jsx(V,{children:"Update Check List"})}),e.jsx("div",{className:"space-y-4 py-2",children:e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Check List Name*"}),e.jsx(N,{placeholder:"Enter checklist name",value:J,onChange:s=>y(s.target.value),className:"border-gray-300 mt-1"})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(i,{variant:"outline",onClick:()=>{F(!1),y(""),m(null)},children:"Cancel"}),e.jsx(i,{onClick:ts,disabled:ce.isPending,className:"bg-[#0076a8] hover:bg-[#005a7d]",children:ce.isPending?"Updating...":"Update"})]})]})}),e.jsx(K,{open:$e,onOpenChange:T,children:e.jsxs(B,{className:"sm:max-w-[400px]",children:[e.jsx(Q,{children:e.jsx(V,{className:"text-[#0076a8]",children:"Delete Confirmation"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"Are you sure want to Delete ?"})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(i,{onClick:ns,disabled:de.isPending,className:"bg-red-600 hover:bg-red-700",children:de.isPending?"Deleting...":"Delete"})]})]})}),e.jsx(K,{open:ze,onOpenChange:s=>{s||Se(),G(s)},children:e.jsxs(B,{className:"right-side-modal bg-white overflow-y-auto shadow-2xl",children:[e.jsx(Q,{className:"px-6 py-4 border-b",children:e.jsx(V,{children:"Add Document"})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Check List Name"}),e.jsx(N,{value:(d==null?void 0:d.name)||"",disabled:!0,className:"border-gray-300 mt-1 bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Document Name*"}),e.jsx(N,{placeholder:"Document Name",value:Y,onChange:s=>X(s.target.value),className:"border-gray-300 mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Select Folder *"}),e.jsxs("div",{className:"relative mt-1",ref:se,children:[e.jsx(N,{placeholder:"Search and select folder/sub-folder...",value:ge,onChange:s=>{q(s.target.value),j(!0)},onFocus:()=>j(!0),className:"border-gray-300"}),Ke&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto",children:ye.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No folders found"}):ye.map(s=>e.jsx("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-gray-100",onClick:()=>{ee(s.id),q(s.name),j(!1)},children:s.name},`folder-${s.id}`))})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Select Document From Briefcase *"}),e.jsxs("div",{className:"relative mt-1 document-dropdown",children:[_&&e.jsxs("div",{className:"flex items-center justify-between w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx("span",{className:"text-sm truncate",children:_}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:Ye,className:"h-4 w-4 p-0 hover:bg-gray-200",children:e.jsx(vs,{className:"h-3 w-3"})})]}),!_&&e.jsxs("div",{children:[e.jsx(N,{placeholder:"Search and select document from briefcase...",value:W,onChange:s=>C(s.target.value),onFocus:()=>k(!0),className:"border-gray-300"}),Z&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto",children:Ne.length>0?Ne.map(s=>e.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onClick:()=>Je(s),children:e.jsx("span",{className:"truncate",children:s.name})},s.id)):e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:W?"No documents found":"No documents available"})})]})]})]}),e.jsx("div",{className:"text-center text-gray-500",children:"-------------------------------------------- OR --------------------------------------------"}),e.jsxs("div",{children:[e.jsx(x,{className:"text-sm font-medium text-gray-700",children:"Upload New Document *"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("input",{type:"file",onChange:s=>{s.target.files&&s.target.files[0]&&(P(s.target.files[0]),b(""),O("upload"))},className:`w-full p-2 border rounded-md ${w?"border-gray-200 bg-gray-100 cursor-not-allowed":"border-gray-300"}`,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",disabled:w!==""}),w&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"File upload is disabled because you selected a document from briefcase"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t px-6 py-4",children:[e.jsx(i,{onClick:ds,disabled:oe.isPending,className:"bg-[#0076a8] hover:bg-[#005a7d]",children:oe.isPending?"Adding...":"Submit"}),e.jsx(i,{variant:"outline",onClick:()=>{Se(),G(!1)},children:"Cancel"})]}),$.length>0&&e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Ie,{children:[e.jsx(Fe,{children:e.jsxs(g,{className:"bg-[#0076a8]",children:[e.jsx(o,{className:"font-semibold text-white",children:"DOCUMENT NAME"}),e.jsx(o,{className:"font-semibold text-white",children:"CREATED BY"}),e.jsx(o,{className:"font-semibold text-white",children:"CREATED DATE"}),e.jsx(o,{className:"font-semibold text-white text-center",children:"ACTION"})]})}),e.jsx(Te,{children:Ze.map(s=>e.jsxs(g,{className:"hover:bg-gray-50",children:[e.jsx(c,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:s.documentName})]})}),e.jsx(c,{children:s.createdBy}),e.jsx(c,{children:new Date(s.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+", "+new Date(s.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx(c,{children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>rs(s),className:"h-8 w-8 p-0 hover:bg-blue-100",title:"Download Document",children:e.jsx(Ns,{className:"h-4 w-4 text-blue-600"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>cs(s),className:"h-8 w-8 p-0 hover:bg-red-100",title:"Remove Document",children:e.jsx(Pe,{className:"h-4 w-4 text-red-600"})})]})})]},s.id))})]})}),Ce>0&&e.jsxs("div",{className:"bg-white px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Show"}),e.jsxs(Oe,{value:M.toString(),onValueChange:s=>Ve(Number(s)),children:[e.jsx(Ae,{className:"w-16 h-8",children:e.jsx(qe,{})}),e.jsxs(Ue,{children:[e.jsx(v,{value:"10",children:"10"}),e.jsx(v,{value:"25",children:"25"}),e.jsx(v,{value:"50",children:"50"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",D," of ",le]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ae(s=>Math.max(s-1,1)),disabled:D===1,className:"px-3 h-8",children:"Prev"}),e.jsx("span",{className:"px-3 py-1 bg-purple-600 text-white text-sm rounded min-w-[32px] text-center",children:D}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ae(s=>Math.min(s+1,le)),disabled:D===le,className:"px-3 h-8",children:"Next"})]})]})]})]})})]})}function Ds(){return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Checklist"})}),e.jsx(ys,{})]})}export{Ds as default};
