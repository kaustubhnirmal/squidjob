import{r as i,u as q,a as Ve,j as e,c as He,P as G,b as Z,d as W,e as H,f as We,g as ze,h as ve,D as Ye,i as Xe,k as Qe,l as qe,L as N,I as C,m as $e,B as D,n as Ge,R as Ke,C as Je,o as Ze,p as et,q as tt,F as se,U as me,T as ne,s as le,t as X,v as S,w as ae,x as w,X as ue,y as xe,z as rt,A as st,E as fe,S as nt,G as lt,H as at,J as ot,K as it,M as ct,N as dt,O as ht,Q as mt,V as ut,W as xt,Y as ft,Z as pt}from"./index-DSPCxSv1.js";function vt(t,s){return i.useReducer((r,c)=>s[r][c]??r,t)}var oe="ScrollArea",[ge,Ft]=He(oe),[gt,P]=ge(oe),be=i.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:c="hover",dir:l,scrollHideDelay:n=600,...d}=t,[o,m]=i.useState(null),[a,x]=i.useState(null),[p,f]=i.useState(null),[b,E]=i.useState(null),[F,L]=i.useState(null),[y,I]=i.useState(0),[z,M]=i.useState(0),[_,k]=i.useState(!1),[Y,U]=i.useState(!1),j=q(s,O=>m(O)),T=Ve(l);return e.jsx(gt,{scope:r,type:c,dir:T,scrollHideDelay:n,scrollArea:o,viewport:a,onViewportChange:x,content:p,onContentChange:f,scrollbarX:b,onScrollbarXChange:E,scrollbarXEnabled:_,onScrollbarXEnabledChange:k,scrollbarY:F,onScrollbarYChange:L,scrollbarYEnabled:Y,onScrollbarYEnabledChange:U,onCornerWidthChange:I,onCornerHeightChange:M,children:e.jsx(G.div,{dir:T,...d,ref:j,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":z+"px",...t.style}})})});be.displayName=oe;var je="ScrollAreaViewport",Se=i.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:c,nonce:l,...n}=t,d=P(je,r),o=i.useRef(null),m=q(s,o,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),e.jsx(G.div,{"data-radix-scroll-area-viewport":"",...n,ref:m,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:c})})]})});Se.displayName=je;var R="ScrollAreaScrollbar",ie=i.forwardRef((t,s)=>{const{forceMount:r,...c}=t,l=P(R,t.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:d}=l,o=t.orientation==="horizontal";return i.useEffect(()=>(o?n(!0):d(!0),()=>{o?n(!1):d(!1)}),[o,n,d]),l.type==="hover"?e.jsx(bt,{...c,ref:s,forceMount:r}):l.type==="scroll"?e.jsx(jt,{...c,ref:s,forceMount:r}):l.type==="auto"?e.jsx(we,{...c,ref:s,forceMount:r}):l.type==="always"?e.jsx(ce,{...c,ref:s}):null});ie.displayName=R;var bt=i.forwardRef((t,s)=>{const{forceMount:r,...c}=t,l=P(R,t.__scopeScrollArea),[n,d]=i.useState(!1);return i.useEffect(()=>{const o=l.scrollArea;let m=0;if(o){const a=()=>{window.clearTimeout(m),d(!0)},x=()=>{m=window.setTimeout(()=>d(!1),l.scrollHideDelay)};return o.addEventListener("pointerenter",a),o.addEventListener("pointerleave",x),()=>{window.clearTimeout(m),o.removeEventListener("pointerenter",a),o.removeEventListener("pointerleave",x)}}},[l.scrollArea,l.scrollHideDelay]),e.jsx(Z,{present:r||n,children:e.jsx(we,{"data-state":n?"visible":"hidden",...c,ref:s})})}),jt=i.forwardRef((t,s)=>{const{forceMount:r,...c}=t,l=P(R,t.__scopeScrollArea),n=t.orientation==="horizontal",d=te(()=>m("SCROLL_END"),100),[o,m]=vt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(o==="idle"){const a=window.setTimeout(()=>m("HIDE"),l.scrollHideDelay);return()=>window.clearTimeout(a)}},[o,l.scrollHideDelay,m]),i.useEffect(()=>{const a=l.viewport,x=n?"scrollLeft":"scrollTop";if(a){let p=a[x];const f=()=>{const b=a[x];p!==b&&(m("SCROLL"),d()),p=b};return a.addEventListener("scroll",f),()=>a.removeEventListener("scroll",f)}},[l.viewport,n,m,d]),e.jsx(Z,{present:r||o!=="hidden",children:e.jsx(ce,{"data-state":o==="hidden"?"hidden":"visible",...c,ref:s,onPointerEnter:W(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:W(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),we=i.forwardRef((t,s)=>{const r=P(R,t.__scopeScrollArea),{forceMount:c,...l}=t,[n,d]=i.useState(!1),o=t.orientation==="horizontal",m=te(()=>{if(r.viewport){const a=r.viewport.offsetWidth<r.viewport.scrollWidth,x=r.viewport.offsetHeight<r.viewport.scrollHeight;d(o?a:x)}},10);return Q(r.viewport,m),Q(r.content,m),e.jsx(Z,{present:c||n,children:e.jsx(ce,{"data-state":n?"visible":"hidden",...l,ref:s})})}),ce=i.forwardRef((t,s)=>{const{orientation:r="vertical",...c}=t,l=P(R,t.__scopeScrollArea),n=i.useRef(null),d=i.useRef(0),[o,m]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),a=Te(o.viewport,o.content),x={...c,sizes:o,onSizesChange:m,hasThumb:a>0&&a<1,onThumbChange:f=>n.current=f,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:f=>d.current=f};function p(f,b){return Et(f,d.current,o,b)}return r==="horizontal"?e.jsx(St,{...x,ref:s,onThumbPositionChange:()=>{if(l.viewport&&n.current){const f=l.viewport.scrollLeft,b=pe(f,o,l.dir);n.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:f=>{l.viewport&&(l.viewport.scrollLeft=f)},onDragScroll:f=>{l.viewport&&(l.viewport.scrollLeft=p(f,l.dir))}}):r==="vertical"?e.jsx(wt,{...x,ref:s,onThumbPositionChange:()=>{if(l.viewport&&n.current){const f=l.viewport.scrollTop,b=pe(f,o);n.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:f=>{l.viewport&&(l.viewport.scrollTop=f)},onDragScroll:f=>{l.viewport&&(l.viewport.scrollTop=p(f))}}):null}),St=i.forwardRef((t,s)=>{const{sizes:r,onSizesChange:c,...l}=t,n=P(R,t.__scopeScrollArea),[d,o]=i.useState(),m=i.useRef(null),a=q(s,m,n.onScrollbarXChange);return i.useEffect(()=>{m.current&&o(getComputedStyle(m.current))},[m]),e.jsx(Ne,{"data-orientation":"horizontal",...l,ref:a,sizes:r,style:{bottom:0,left:n.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:n.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ee(r)+"px",...t.style},onThumbPointerDown:x=>t.onThumbPointerDown(x.x),onDragScroll:x=>t.onDragScroll(x.x),onWheelScroll:(x,p)=>{if(n.viewport){const f=n.viewport.scrollLeft+x.deltaX;t.onWheelScroll(f),Pe(f,p)&&x.preventDefault()}},onResize:()=>{m.current&&n.viewport&&d&&c({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:J(d.paddingLeft),paddingEnd:J(d.paddingRight)}})}})}),wt=i.forwardRef((t,s)=>{const{sizes:r,onSizesChange:c,...l}=t,n=P(R,t.__scopeScrollArea),[d,o]=i.useState(),m=i.useRef(null),a=q(s,m,n.onScrollbarYChange);return i.useEffect(()=>{m.current&&o(getComputedStyle(m.current))},[m]),e.jsx(Ne,{"data-orientation":"vertical",...l,ref:a,sizes:r,style:{top:0,right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ee(r)+"px",...t.style},onThumbPointerDown:x=>t.onThumbPointerDown(x.y),onDragScroll:x=>t.onDragScroll(x.y),onWheelScroll:(x,p)=>{if(n.viewport){const f=n.viewport.scrollTop+x.deltaY;t.onWheelScroll(f),Pe(f,p)&&x.preventDefault()}},onResize:()=>{m.current&&n.viewport&&d&&c({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:J(d.paddingTop),paddingEnd:J(d.paddingBottom)}})}})}),[yt,ye]=ge(R),Ne=i.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:c,hasThumb:l,onThumbChange:n,onThumbPointerUp:d,onThumbPointerDown:o,onThumbPositionChange:m,onDragScroll:a,onWheelScroll:x,onResize:p,...f}=t,b=P(R,r),[E,F]=i.useState(null),L=q(s,j=>F(j)),y=i.useRef(null),I=i.useRef(""),z=b.viewport,M=c.content-c.viewport,_=H(x),k=H(m),Y=te(p,10);function U(j){if(y.current){const T=j.clientX-y.current.left,O=j.clientY-y.current.top;a({x:T,y:O})}}return i.useEffect(()=>{const j=T=>{const O=T.target;(E==null?void 0:E.contains(O))&&_(T,M)};return document.addEventListener("wheel",j,{passive:!1}),()=>document.removeEventListener("wheel",j,{passive:!1})},[z,E,M,_]),i.useEffect(k,[c,k]),Q(E,Y),Q(b.content,Y),e.jsx(yt,{scope:r,scrollbar:E,hasThumb:l,onThumbChange:H(n),onThumbPointerUp:H(d),onThumbPositionChange:k,onThumbPointerDown:H(o),children:e.jsx(G.div,{...f,ref:L,style:{position:"absolute",...f.style},onPointerDown:W(t.onPointerDown,j=>{j.button===0&&(j.target.setPointerCapture(j.pointerId),y.current=E.getBoundingClientRect(),I.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),U(j))}),onPointerMove:W(t.onPointerMove,U),onPointerUp:W(t.onPointerUp,j=>{const T=j.target;T.hasPointerCapture(j.pointerId)&&T.releasePointerCapture(j.pointerId),document.body.style.webkitUserSelect=I.current,b.viewport&&(b.viewport.style.scrollBehavior=""),y.current=null})})})}),K="ScrollAreaThumb",Ce=i.forwardRef((t,s)=>{const{forceMount:r,...c}=t,l=ye(K,t.__scopeScrollArea);return e.jsx(Z,{present:r||l.hasThumb,children:e.jsx(Nt,{ref:s,...c})})}),Nt=i.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:c,...l}=t,n=P(K,r),d=ye(K,r),{onThumbPositionChange:o}=d,m=q(s,p=>d.onThumbChange(p)),a=i.useRef(void 0),x=te(()=>{a.current&&(a.current(),a.current=void 0)},100);return i.useEffect(()=>{const p=n.viewport;if(p){const f=()=>{if(x(),!a.current){const b=Tt(p,o);a.current=b,o()}};return o(),p.addEventListener("scroll",f),()=>p.removeEventListener("scroll",f)}},[n.viewport,x,o]),e.jsx(G.div,{"data-state":d.hasThumb?"visible":"hidden",...l,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...c},onPointerDownCapture:W(t.onPointerDownCapture,p=>{const b=p.target.getBoundingClientRect(),E=p.clientX-b.left,F=p.clientY-b.top;d.onThumbPointerDown({x:E,y:F})}),onPointerUp:W(t.onPointerUp,d.onThumbPointerUp)})});Ce.displayName=K;var de="ScrollAreaCorner",Ee=i.forwardRef((t,s)=>{const r=P(de,t.__scopeScrollArea),c=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&c?e.jsx(Ct,{...t,ref:s}):null});Ee.displayName=de;var Ct=i.forwardRef((t,s)=>{const{__scopeScrollArea:r,...c}=t,l=P(de,r),[n,d]=i.useState(0),[o,m]=i.useState(0),a=!!(n&&o);return Q(l.scrollbarX,()=>{var p;const x=((p=l.scrollbarX)==null?void 0:p.offsetHeight)||0;l.onCornerHeightChange(x),m(x)}),Q(l.scrollbarY,()=>{var p;const x=((p=l.scrollbarY)==null?void 0:p.offsetWidth)||0;l.onCornerWidthChange(x),d(x)}),a?e.jsx(G.div,{...c,ref:s,style:{width:n,height:o,position:"absolute",right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function J(t){return t?parseInt(t,10):0}function Te(t,s){const r=t/s;return isNaN(r)?0:r}function ee(t){const s=Te(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,c=(t.scrollbar.size-r)*s;return Math.max(c,18)}function Et(t,s,r,c="ltr"){const l=ee(r),n=l/2,d=s||n,o=l-d,m=r.scrollbar.paddingStart+d,a=r.scrollbar.size-r.scrollbar.paddingEnd-o,x=r.content-r.viewport,p=c==="ltr"?[0,x]:[x*-1,0];return De([m,a],p)(t)}function pe(t,s,r="ltr"){const c=ee(s),l=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,n=s.scrollbar.size-l,d=s.content-s.viewport,o=n-c,m=r==="ltr"?[0,d]:[d*-1,0],a=ze(t,m);return De([0,d],[0,o])(a)}function De(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const c=(s[1]-s[0])/(t[1]-t[0]);return s[0]+c*(r-t[0])}}function Pe(t,s){return t>0&&t<s}var Tt=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},c=0;return function l(){const n={left:t.scrollLeft,top:t.scrollTop},d=r.left!==n.left,o=r.top!==n.top;(d||o)&&s(),r=n,c=window.requestAnimationFrame(l)}(),()=>window.cancelAnimationFrame(c)};function te(t,s){const r=H(t),c=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(c.current),[]),i.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(r,s)},[r,s])}function Q(t,s){const r=H(s);We(()=>{let c=0;if(t){const l=new ResizeObserver(()=>{cancelAnimationFrame(c),c=window.requestAnimationFrame(r)});return l.observe(t),()=>{window.cancelAnimationFrame(c),l.unobserve(t)}}},[t,r])}var Ae=be,Dt=Se,Pt=Ee;const Re=i.forwardRef(({className:t,children:s,...r},c)=>e.jsxs(Ae,{ref:c,className:ve("relative overflow-hidden",t),...r,children:[e.jsx(Dt,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Fe,{}),e.jsx(Pt,{})]}));Re.displayName=Ae.displayName;const Fe=i.forwardRef(({className:t,orientation:s="vertical",...r},c)=>e.jsx(ie,{ref:c,orientation:s,className:ve("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(Ce,{className:"relative flex-1 rounded-full bg-border"})}));Fe.displayName=ie.displayName;function At({isOpen:t,onClose:s,data:r,onSave:c,index:l}){const[n,d]=i.useState(r),o=(a,x)=>{d(p=>({...p,[a]:x}))},m=()=>{c(n),s()};return e.jsx(Ye,{open:t,onOpenChange:s,children:e.jsxs(Xe,{className:"sm:max-w-2xl",children:[e.jsx(Qe,{children:e.jsxs(qe,{children:["Edit Tender Data (PDF ",l+1,")"]})}),e.jsx(Re,{className:"h-[60vh] pr-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"bidNumber",children:"Bid Number"}),e.jsx(C,{id:"bidNumber",value:n["Bid Number"],onChange:a=>o("Bid Number",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"dated",children:"Dated"}),e.jsx(C,{id:"dated",value:n.Dated,onChange:a=>o("Dated",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"bidEndDate",children:"Bid End Date/Time"}),e.jsx(C,{id:"bidEndDate",value:n["Bid End Date/Time"],onChange:a=>o("Bid End Date/Time",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"bidOpeningDate",children:"Bid Opening Date/Time"}),e.jsx(C,{id:"bidOpeningDate",value:n["Bid Opening Date/Time"],onChange:a=>o("Bid Opening Date/Time",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"bidValidity",children:"Bid Offer Validity (From End Date)"}),e.jsx(C,{id:"bidValidity",value:n["Bid Offer Validity (From End Date)"],onChange:a=>o("Bid Offer Validity (From End Date)",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"ministryName",children:"Ministry/State Name"}),e.jsx(C,{id:"ministryName",value:n["Ministry/State Name"],onChange:a=>o("Ministry/State Name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"departmentName",children:"Department Name"}),e.jsx(C,{id:"departmentName",value:n["Department Name"],onChange:a=>o("Department Name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"organisationName",children:"Organisation Name"}),e.jsx(C,{id:"organisationName",value:n["Organisation Name"],onChange:a=>o("Organisation Name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"officeName",children:"Office Name"}),e.jsx(C,{id:"officeName",value:n["Office Name"],onChange:a=>o("Office Name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"buyerEmail",children:"Buyer Email"}),e.jsx(C,{id:"buyerEmail",value:n["Buyer Email"],onChange:a=>o("Buyer Email",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"totalQuantity",children:"Total Quantity"}),e.jsx(C,{id:"totalQuantity",value:n["Total Quantity"],onChange:a=>o("Total Quantity",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"boqTitle",children:"BOQ Title"}),e.jsx(C,{id:"boqTitle",value:n["BOQ Title"],onChange:a=>o("BOQ Title",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"mseExemption",children:"MSE Exemption for Years of Experience and Turnover"}),e.jsx(C,{id:"mseExemption",value:n["MSE Exemption for Years of Experience and Turnover"],onChange:a=>o("MSE Exemption for Years of Experience and Turnover",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"emdAmount",children:"EMD Amount"}),e.jsx(C,{id:"emdAmount",value:n["EMD Amount"],onChange:a=>o("EMD Amount",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"bidValue",children:"Bid Value"}),e.jsx(C,{id:"bidValue",value:n["Bid Value"],onChange:a=>o("Bid Value",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"epbgDetail",children:"ePBG Detail: Required"}),e.jsx(C,{id:"epbgDetail",value:n["ePBG Detail: Required"],onChange:a=>o("ePBG Detail: Required",a.target.value)})]})]})}),e.jsxs($e,{children:[e.jsx(D,{variant:"outline",onClick:s,children:"Cancel"}),e.jsx(D,{onClick:m,children:"Save Changes"})]})]})})}function Ot(){const{toast:t}=Ge(),[s,r]=i.useState([]),[c,l]=i.useState(!1),[n,d]=i.useState(0),[o,m]=i.useState([]),[a,x]=i.useState("upload"),[p,f]=i.useState(!1),[b,E]=i.useState(""),[F,L]=i.useState(!1),[y,I]=i.useState("pdf"),z=i.useRef(null),M=i.useRef(null),_=h=>{if(h.target.files){const u=Array.from(h.target.files);if(y==="pdf"){if(u.length>5){t({title:"Too many files",description:"You can upload a maximum of 5 PDF files at once.",variant:"destructive"});return}if(u.filter(g=>g.type!=="application/pdf").length>0){t({title:"Invalid file type",description:"Only PDF files are allowed.",variant:"destructive"});return}}else if(y==="excel"){if(u.length>1){t({title:"Too many files",description:"You can upload only 1 Excel file at a time.",variant:"destructive"});return}const v=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"];if(u.filter(A=>!v.includes(A.type)&&!A.name.endsWith(".xls")&&!A.name.endsWith(".xlsx")&&!A.name.endsWith(".csv")).length>0){t({title:"Invalid file type",description:"Only Excel or CSV files are allowed.",variant:"destructive"});return}}r(u)}},k=h=>{r(u=>u.filter((v,g)=>g!==h))},Y=async()=>{l(!0),d(0);const h=new FormData;s.forEach(u=>{h.append("files",u)}),h.append("importMethod",y);try{const u=setInterval(()=>{d(B=>B>=95?(clearInterval(u),95):B+5)},200);setTimeout(()=>{L(!0)},s.length*200);const g=await fetch(y==="pdf"?"/api/import-tender/upload-pdf":"/api/import-tender/upload-excel",{method:"POST",body:h});if(clearInterval(u),d(100),!g.ok)throw new Error(`Upload failed: ${g.statusText}`);const A=await g.json();m(A.data),x("preview")}catch(u){console.error("Error uploading files:",u);const v=u instanceof Error?u.message:"Error uploading or processing files";E(v),f(!0)}finally{l(!1),L(!1)}},U=()=>{const h=["Bid Number","Dated","Bid End Date/Time","Bid Opening Date/Time","Bid Offer Validity (From End Date)","Ministry/State Name","Department Name","Organisation Name","Office Name","Buyer Email","Total Quantity","BOQ Title","MSE Exemption for Years of Experience and Turnover","EMD Amount","Bid Value","ePBG Detail: Required"],u=["GEM/2025/B/1234567","01-04-2025","15-04-2025 15:00:00","15-04-2025 15:30:00","120 (Days)","Ministry of Finance","Department of Revenue","Income Tax Department","Central Office","buyer@example.gov.in","1000","Supply of IT Equipment","No","50000","5000000","No"],v=[h.join(","),u.join(",")].join(`
`),g=new Blob([v],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(g),B=document.createElement("a");B.setAttribute("href",A),B.setAttribute("download","tender_import_template.csv"),document.body.appendChild(B),B.click(),document.body.removeChild(B),t({title:"Template downloaded",description:"Fill this template with your tender data and upload it for bulk import."})},j=()=>{if(s.length===0){t({title:"No files selected",description:y==="pdf"?"Please select at least one PDF file to upload.":"Please select an Excel or CSV file to upload.",variant:"destructive"});return}if(y==="excel"&&s.length>1){t({title:"Too many files",description:"You can only upload one Excel/CSV file at a time.",variant:"destructive"});return}Y().catch(h=>{console.error("Upload failed:",h),t({title:"Upload failed",description:h instanceof Error?h.message:`Failed to process ${y==="pdf"?"PDF":"Excel/CSV"} file${s.length>1?"s":""}`,variant:"destructive"}),L(!1),l(!1)})},T=()=>{r([]),x("upload"),m([])},O=async()=>{try{l(!0);const h=o.map((g,A)=>({...g,assignedTo:$[A]||null})),u=await fetch("/api/import-tender/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenders:h,assignments:$})});if(!u.ok)throw new Error(`Failed to save tenders: ${u.statusText}`);const v=await u.json();t({title:"Tenders imported successfully",description:v.message||`${o.length} tenders have been imported and added to the system.`}),r([]),x("upload"),m([])}catch(h){console.error("Error saving tenders:",h),t({title:"Import failed",description:h instanceof Error?h.message:"There was an error saving the tenders. Please try again.",variant:"destructive"})}finally{l(!1)}},[V,Oe]=i.useState(null),[Be,he]=i.useState(!1),[re,Le]=i.useState([]),[$,Ie]=i.useState({});Ke.useEffect(()=>{(async()=>{try{const u=await fetch("/api/users");if(u.ok){const v=await u.json();Le(v)}}catch(u){console.error("Error fetching users:",u)}})()},[]);const Me=h=>{Oe(h),he(!0)},_e=(h,u)=>{Ie(g=>({...g,[h]:u}));const v=re.find(g=>g.id===u);v&&t({title:"Tender assigned",description:`Tender will be assigned to ${v.name} on import.`})},ke=h=>{m(u=>{const v=[...u];return v.splice(h,1),v}),t({title:"Tender removed",description:"The tender has been removed from the import list."})},Ue=h=>{V!==null&&(m(u=>{const v=[...u];return v[V]=h,v}),t({title:"Tender data updated",description:"The tender data has been updated successfully."}))};return e.jsxs("div",{className:"p-6 bg-gray-100 min-h-screen",children:[e.jsxs(Je,{className:"w-full mx-auto mb-6",children:[e.jsx(Ze,{className:"bg-white",children:e.jsx(et,{className:"text-xl font-semibold",children:"Import Tender Data"})}),e.jsxs(tt,{className:"p-6",children:[a==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"Import Methods"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:`p-4 rounded-md flex-1 cursor-pointer border ${y==="pdf"?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,onClick:()=>I("pdf"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsx("h4",{className:"font-medium",children:"From PDF"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Extract tender data automatically from GEM bidding PDFs. Upload up to 5 files at once."})]}),e.jsxs("div",{className:`p-4 rounded-md flex-1 cursor-pointer border ${y==="excel"?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,onClick:()=>I("excel"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-medium",children:"From Excel/CSV"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Upload Excel or CSV file with tender data in the required format.",e.jsx("a",{href:"#",onClick:h=>{h.preventDefault(),U()},className:"text-blue-600 ml-1 underline",children:"Download template"})]})]})]})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:y==="pdf"?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:z,type:"file",multiple:!0,accept:".pdf",onChange:_,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-600",children:"Drag and drop PDF files here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Upload up to 5 PDF files (Max 10MB each)"})]}),e.jsx(D,{onClick:()=>{var h;return(h=z.current)==null?void 0:h.click()},className:"mt-2",children:"Select PDF Files"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:M,type:"file",accept:".xls,.xlsx,.csv",onChange:_,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-600",children:"Drag and drop Excel/CSV file here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use our template format for accurate import (Max 10MB)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{onClick:()=>{var h;return(h=M.current)==null?void 0:h.click()},className:"mt-2",children:"Select Excel/CSV File"}),e.jsx(D,{variant:"outline",onClick:U,className:"mt-2",children:"Download Template"})]})]})]})}),s.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Selected Files"}),e.jsx("div",{className:"bg-white rounded-md shadow",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(X,{children:[e.jsx(S,{className:"w-12",children:"#"}),e.jsx(S,{children:"File Name"}),e.jsx(S,{className:"w-24",children:"Size"}),e.jsx(S,{className:"w-20 text-right",children:"Action"})]})}),e.jsx(ae,{children:s.map((h,u)=>e.jsxs(X,{children:[e.jsx(w,{children:u+1}),e.jsxs(w,{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-blue-500"}),h.name]}),e.jsxs(w,{children:[(h.size/1024).toFixed(2)," KB"]}),e.jsx(w,{className:"text-right",children:e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>k(u),children:e.jsx(ue,{className:"h-4 w-4 text-red-500"})})})]},u))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(D,{variant:"outline",onClick:T,children:"Cancel"}),e.jsx(D,{onClick:j,disabled:s.length===0||c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}),F?"Processing...":"Uploading..."]}):"Upload and Extract Data"})]}),c&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium mb-1",children:[e.jsx("span",{children:F?"Processing PDF content...":"Uploading files..."}),e.jsxs("span",{children:[n,"%"]})]}),e.jsx(rt,{value:n,className:"h-2"})]})]}),a==="preview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-300 text-yellow-800 p-4 rounded-md flex items-start mb-4",children:[e.jsx(st,{className:"h-5 w-5 mr-2 mt-0.5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Review the extracted data"}),e.jsx("p",{className:"text-sm",children:"Please verify the data extracted from the PDF files. Edit any incorrect values before importing."})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(X,{children:[e.jsx(S,{className:"w-12",children:"#"}),e.jsx(S,{children:"Bid Number"}),e.jsx(S,{children:"Dated"}),e.jsx(S,{children:"Bid End Date/Time"}),e.jsx(S,{children:"Organisation"}),e.jsx(S,{children:"BOQ Title"}),e.jsx(S,{children:"EMD Amount"}),e.jsx(S,{children:"Status"}),e.jsx(S,{className:"w-40 text-center",children:"Assign Tender"}),e.jsx(S,{className:"w-20 text-center",children:"Actions"})]})}),e.jsx(ae,{children:o.map((h,u)=>{var v;return e.jsxs(X,{className:"hover:bg-gray-50",children:[e.jsx(w,{children:u+1}),e.jsx(w,{className:"font-medium",children:h["Bid Number"]}),e.jsx(w,{children:h.Dated}),e.jsx(w,{children:h["Bid End Date/Time"]}),e.jsx(w,{children:h["Organisation Name"]}),e.jsx(w,{children:h["BOQ Title"]}),e.jsx(w,{children:h["EMD Amount"]}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"text-green-700 text-sm",children:"Valid"})]})}),e.jsx(w,{children:e.jsxs(nt,{onValueChange:g=>_e(u,parseInt(g)),value:((v=$[u])==null?void 0:v.toString())||"",children:[e.jsx(lt,{className:"w-full",children:e.jsx(at,{placeholder:"Assign to..."})}),e.jsx(ot,{children:re.map(g=>e.jsx(it,{value:g.id.toString(),children:g.name||g.username},g.id))})]})}),e.jsx(w,{children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>Me(u),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-50",title:"Edit",children:e.jsx(ct,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>ke(u),className:"text-red-600 hover:text-red-800 hover:bg-red-50",title:"Delete",children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},u)})})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(D,{variant:"outline",onClick:T,children:"Cancel"}),e.jsx(D,{onClick:()=>x("confirm"),children:"Confirm and Import"})]})]}),a==="confirm"&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-300 text-green-800 p-4 rounded-md flex items-start mb-4",children:[e.jsx(fe,{className:"h-5 w-5 mr-2 mt-0.5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Ready to import"}),e.jsxs("p",{className:"text-sm",children:["You are about to import ",o.length," tender(s) into the system. This action cannot be undone."]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(X,{children:[e.jsx(S,{className:"w-12",children:"#"}),e.jsx(S,{children:"Bid Number"}),e.jsx(S,{children:"Dated"}),e.jsx(S,{children:"Bid End Date/Time"}),e.jsx(S,{children:"Organisation"}),e.jsx(S,{children:"BOQ Title"})]})}),e.jsx(ae,{children:o.map((h,u)=>{var v;return e.jsxs(X,{children:[e.jsx(w,{children:u+1}),e.jsx(w,{className:"font-medium",children:h["Bid Number"]}),e.jsx(w,{children:h.Dated}),e.jsx(w,{children:h["Bid End Date/Time"]}),e.jsx(w,{children:h["Organisation Name"]}),e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:h["BOQ Title"]}),$[u]&&e.jsxs("span",{className:"text-xs text-blue-600 mt-1",children:["Assigned to: ",((v=re.find(g=>g.id===$[u]))==null?void 0:v.name)||"User"]})]})})]},u)})})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(D,{variant:"outline",onClick:()=>x("preview"),disabled:c,children:"Back"}),e.jsx(D,{onClick:O,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):"Confirm Import"})]})]})]})]}),e.jsx(dt,{open:p,onOpenChange:f,children:e.jsxs(ht,{children:[e.jsxs(mt,{children:[e.jsx(ut,{children:"Error Processing PDF"}),e.jsx(xt,{children:b})]}),e.jsx(ft,{children:e.jsx(pt,{children:"OK"})})]})}),V!==null&&o[V]&&e.jsx(At,{isOpen:Be,onClose:()=>he(!1),data:o[V],onSave:Ue,index:V})]})}export{Ot as default};
